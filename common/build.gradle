apply plugin: 'kotlin-multiplatform'
apply plugin: 'kotlinx-serialization'

kotlin {

    jvm {

    }

    js {
        browser{

        }
        compileKotlinJs {
            kotlinOptions.metaInfo = true
            kotlinOptions.sourceMap = true
            kotlinOptions.moduleKind = "commonjs"
            kotlinOptions.main = "call"
        }
    }

    sourceSets {
        commonRelease {}

        commonDebug {}

        commonMain {
            if (rootProject.hasProperty("debug")) {
                dependsOn commonDebug
            } else {
                dependsOn commonRelease
            }

            dependencies {
                api Libs.kotlinStdlibCommon
                api Libs.kotlinxCoroutinesCoreCommon
                api Libs.kotlinxSerializationRuntimeCommon
                api Libs.ktorClientCore
                api Libs.ktorClientJson
                api Libs.ktorClientLogging
                api Libs.ktorClientSerialization
            }
        }

        commonTest {
            dependencies {
                api Libs.kotlinTestCommon
            }
        }

        jvmMain {
            dependencies {
                api Libs.kotlinStdlib
                api Libs.kotlinxSerializationRuntime
                api Libs.ktorClientJsonJvm
                api Libs.ktorClientLoggingJvm
                api Libs.ktorClientSerializationJvm
            }
        }

        jvmTest {
            dependencies {
                api Libs.junit
                api Libs.kotlinTestJunit
                api Libs.kotlinTest
            }
        }

        jsMain {
            dependencies {
                api Libs.kotlinStdlibJs
                api Libs.kotlinxSerializationRuntimeJs
                api Libs.ktorClientJs
                api Libs.ktorClientJsonJs
                api Libs.ktorClientLoggingJs
                api Libs.ktorClientSerializationJs
            }
        }

        jsTest {
            dependencies {
                api Libs.kotlinTestJs
            }
        }
    }
}

configurations {
    compileClasspath
}

detekt {
    input = files(
            "src/commonMain/kotlin",
            "src/jsMain/kotlin",
    )
}
